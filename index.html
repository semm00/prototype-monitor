<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protótipo de App de Monitoramento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .screen.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toggle-checkbox:checked {
            right: 0;
            border-color: #4ade80;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #4ade80;
        }
        .block-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .block-content.open {
            max-height: 1000px; /* Valor alto para acomodar o conteúdo */
        }
        .chevron-icon {
            transition: transform 0.3s ease-out;
        }
        .open .chevron-icon {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="w-full max-w-sm mx-auto bg-white shadow-lg rounded-b-2xl h-screen flex flex-col">
        <!-- Cabeçalho Fixo -->
        <header class="bg-slate-800 text-white p-4 rounded-t-lg flex items-center justify-between shadow-md z-10">
            <h1 id="header-title" class="text-xl font-bold">Monitoramento</h1>
            <div class="relative">
                <i data-lucide="bell" class="w-6 h-6"></i>
                <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-slate-800"></span>
            </div>
        </header>

        <!-- Conteúdo Principal (Telas) -->
        <main class="flex-grow p-4 overflow-y-auto">
            <!-- Tela 1: Dashboard -->
            <div id="dashboard-screen" class="screen active">
                <h2 class="text-lg font-semibold text-gray-700 mb-4">Status dos Equipamentos</h2>
                <div id="block-list" class="space-y-4">
                    <!-- Blocos e salas serão injetados aqui pelo JS -->
                </div>
            </div>

            <!-- Tela 2: Cadastro de Salas -->
            <div id="add-room-screen" class="screen">
                 <h2 class="text-lg font-semibold text-gray-700 mb-4">Cadastrar Nova Sala/Setor</h2>
                 <div class="bg-white p-4 rounded-lg shadow space-y-4">
                    <div>
                        <label for="block-select" class="block text-sm font-medium text-gray-600">Selecione o Bloco</label>
                        <select id="block-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md bg-gray-50">
                            <!-- Opções de bloco serão injetadas aqui -->
                        </select>
                    </div>
                    <div>
                        <label for="room-name" class="block text-sm font-medium text-gray-600">Nome da Sala ou Setor</label>
                        <input type="text" id="room-name" placeholder="Ex: Sala 101" class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <button id="save-room-btn" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center justify-center">
                        <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>
                        Salvar
                    </button>
                 </div>
            </div>

            <!-- Tela 3: Agendamento -->
            <div id="schedule-screen" class="screen">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-700">Agendamentos</h2>
                    <button class="bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700 shadow">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="space-y-3">
                    <div class="bg-white p-3 rounded-lg shadow">
                        <p class="font-bold text-gray-800">Sala 01 - Ar Condicionado</p>
                        <p class="text-sm text-gray-500">Seg à Sex - 08:00 às 12:00</p>
                    </div>
                    <div class="bg-white p-3 rounded-lg shadow">
                        <p class="font-bold text-gray-800">Auditório - Luzes</p>
                        <p class="text-sm text-gray-500">Qua e Sex - 19:00 às 22:00</p>
                    </div>
                     <div class="bg-white p-3 rounded-lg shadow">
                        <p class="font-bold text-gray-800">Laboratório de Química - Ar Condicionado</p>
                        <p class="text-sm text-gray-500">Seg e Ter - 14:00 às 18:00</p>
                    </div>
                </div>
            </div>

            <!-- Tela 4: Relatórios -->
            <div id="reports-screen" class="screen">
                <h2 class="text-lg font-semibold text-gray-700 mb-4">Consumo Mensal (kWh)</h2>
                <div class="bg-white p-4 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-4">
                        <span class="font-medium">Agosto 2024</span>
                        <div>
                            <button class="p-1 text-gray-500 hover:text-gray-800"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                            <button class="p-1 text-gray-500 hover:text-gray-800"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                    <div id="reports-list" class="space-y-4">
                        <!-- Relatório detalhado será injetado aqui -->
                    </div>
                </div>
            </div>

            <!-- Tela 5: Alertas -->
            <div id="alerts-screen" class="screen">
                <h2 class="text-lg font-semibold text-gray-700 mb-4">Notificações de Alerta</h2>
                <div class="space-y-3">
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-3 rounded-r-lg shadow-sm flex items-start">
                        <i data-lucide="alert-triangle" class="w-6 h-6 mr-3 text-red-500"></i>
                        <div>
                            <p class="font-bold">Equipamento Ligado Fora do Horário</p>
                            <p class="text-sm">O ar-condicionado da <strong>Sala 01</strong> ficou ligado após as 22:00.</p>
                            <span class="text-xs text-gray-500">Ontem, 22:15</span>
                        </div>
                    </div>
                     <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-3 rounded-r-lg shadow-sm flex items-start">
                        <i data-lucide="info" class="w-6 h-6 mr-3 text-yellow-500"></i>
                        <div>
                            <p class="font-bold">Consumo Elevado</p>
                            <p class="text-sm">O consumo no <strong>Auditório</strong> está 20% acima da média este mês.</p>
                            <span class="text-xs text-gray-500">Há 2 dias</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Navegação Inferior -->
        <nav class="bg-white border-t border-gray-200 p-2 flex justify-around rounded-b-2xl shadow-inner">
            <button data-screen="dashboard-screen" data-title="Monitoramento" class="nav-btn text-indigo-600 flex flex-col items-center w-full py-1 rounded-lg">
                <i data-lucide="layout-dashboard" class="w-6 h-6 mb-1"></i>
                <span class="text-xs font-medium">Dashboard</span>
            </button>
            <button data-screen="add-room-screen" data-title="Cadastrar Sala" class="nav-btn text-gray-500 flex flex-col items-center w-full py-1 rounded-lg">
                <i data-lucide="plus-square" class="w-6 h-6 mb-1"></i>
                <span class="text-xs font-medium">Cadastrar</span>
            </button>
            <button data-screen="schedule-screen" data-title="Agendamentos" class="nav-btn text-gray-500 flex flex-col items-center w-full py-1 rounded-lg">
                <i data-lucide="calendar-clock" class="w-6 h-6 mb-1"></i>
                <span class="text-xs font-medium">Agendar</span>
            </button>
            <button data-screen="reports-screen" data-title="Relatórios" class="nav-btn text-gray-500 flex flex-col items-center w-full py-1 rounded-lg">
                <i data-lucide="bar-chart-3" class="w-6 h-6 mb-1"></i>
                <span class="text-xs font-medium">Relatórios</span>
            </button>
            <button data-screen="alerts-screen" data-title="Alertas" class="nav-btn text-gray-500 flex flex-col items-center w-full py-1 rounded-lg">
                <i data-lucide="bell-ring" class="w-6 h-6 mb-1"></i>
                <span class="text-xs font-medium">Alertas</span>
            </button>
        </nav>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const state = {
                blocks: [
                    {
                        name: 'Bloco A',
                        rooms: [
                            { id: 1, name: 'Sala 01', acOn: true, lightOn: false, consumption: 150 },
                            { id: 2, name: 'Sala 02', acOn: false, lightOn: false, consumption: 180 },
                        ]
                    },
                    {
                        name: 'Bloco B',
                        rooms: [
                            { id: 3, name: 'Laboratório de Química', acOn: false, lightOn: true, consumption: 220 },
                            { id: 4, name: 'Auditório', acOn: true, lightOn: true, consumption: 200 },
                        ]
                    }
                ],
                currentScreen: 'dashboard-screen',
            };

            const headerTitle = document.getElementById('header-title');
            const blockListContainer = document.getElementById('block-list');
            const navButtons = document.querySelectorAll('.nav-btn');
            const screens = document.querySelectorAll('.screen');
            const saveRoomBtn = document.getElementById('save-room-btn');
            const roomNameInput = document.getElementById('room-name');
            const blockSelect = document.getElementById('block-select');

            function renderBlocks() {
                blockListContainer.innerHTML = '';
                state.blocks.forEach((block, index) => {
                    const blockContainer = document.createElement('div');
                    blockContainer.className = 'bg-gray-50 rounded-lg shadow';
                    
                    let roomsHtml = '';
                    block.rooms.forEach(room => {
                        roomsHtml += `
                            <div class="bg-white p-4 rounded-lg shadow-inner m-2">
                                <h3 class="font-bold text-gray-800 text-lg mb-3">${room.name}</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i data-lucide="air-vent" class="w-5 h-5 mr-2 ${room.acOn ? 'text-blue-500' : 'text-gray-400'}"></i>
                                            <span class="text-gray-600">Ar-condicionado</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="text-sm font-medium mr-3 ${room.acOn ? 'text-green-600' : 'text-gray-500'}">${room.acOn ? 'Ligado' : 'Desligado'}</span>
                                            <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                                <input type="checkbox" data-block-idx="${index}" data-room-id="${room.id}" data-type="ac" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" ${room.acOn ? 'checked' : ''}/>
                                                <label class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i data-lucide="lightbulb" class="w-5 h-5 mr-2 ${room.lightOn ? 'text-yellow-400' : 'text-gray-400'}"></i>
                                            <span class="text-gray-600">Luz</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="text-sm font-medium mr-3 ${room.lightOn ? 'text-green-600' : 'text-gray-500'}">${room.lightOn ? 'Ligado' : 'Desligado'}</span>
                                            <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                                <input type="checkbox" data-block-idx="${index}" data-room-id="${room.id}" data-type="light" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" ${room.lightOn ? 'checked' : ''}/>
                                                <label class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    blockContainer.innerHTML = `
                        <div class="block-header p-4 cursor-pointer flex justify-between items-center">
                            <h3 class="font-bold text-indigo-700 text-xl">${block.name}</h3>
                            <i data-lucide="chevron-right" class="chevron-icon w-6 h-6 text-indigo-700"></i>
                        </div>
                        <div class="block-content space-y-2 p-2 pt-0">
                            ${roomsHtml}
                        </div>
                    `;
                    blockListContainer.appendChild(blockContainer);
                });
                lucide.createIcons();
            }
            
            function renderReports() {
                const reportsList = document.getElementById('reports-list');
                reportsList.innerHTML = '';

                state.blocks.forEach(block => {
                    const totalBlockConsumption = block.rooms.reduce((total, room) => total + room.consumption, 0);

                    let roomsReportHtml = '';
                    block.rooms.forEach(room => {
                        const maxConsumption = 500; // Valor máximo para escalar a barra
                        const percentage = Math.min((room.consumption / maxConsumption) * 100, 100);
                        roomsReportHtml += `
                            <div class="ml-4 pl-4 border-l-2 border-gray-200 py-2">
                                <p class="text-sm text-gray-600">${room.name}</p>
                                <div class="flex items-center mt-1">
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div class="bg-blue-500 h-3 rounded-full" style="width: ${percentage}%;"></div>
                                    </div>
                                    <span class="text-xs ml-3 font-mono text-gray-700 w-20 text-right">${room.consumption} kWh</span>
                                </div>
                            </div>
                        `;
                    });

                    const blockReportHtml = `
                        <div>
                            <div class="flex justify-between items-center font-bold text-gray-800 border-b pb-2">
                                <span>${block.name}</span>
                                <span class="text-sm font-mono bg-gray-100 px-2 py-1 rounded">Total: ${totalBlockConsumption} kWh</span>
                            </div>
                            <div class="mt-2">
                                ${roomsReportHtml}
                            </div>
                        </div>
                    `;

                    reportsList.innerHTML += blockReportHtml;
                });
            }

            function populateBlockSelect() {
                blockSelect.innerHTML = '';
                state.blocks.forEach(block => {
                    const option = document.createElement('option');
                    option.value = block.name;
                    option.textContent = block.name;
                    blockSelect.appendChild(option);
                });
            }

            function showScreen(screenId, title) {
                state.currentScreen = screenId;
                screens.forEach(screen => screen.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
                headerTitle.textContent = title;

                navButtons.forEach(btn => {
                    btn.classList.toggle('text-indigo-600', btn.dataset.screen === screenId);
                    btn.classList.toggle('text-gray-500', btn.dataset.screen !== screenId);
                });
                
                if (screenId === 'add-room-screen') {
                    populateBlockSelect();
                } else if (screenId === 'reports-screen') {
                    renderReports();
                }
            }

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    showScreen(button.dataset.screen, button.dataset.title);
                });
            });

            blockListContainer.addEventListener('change', (e) => {
                if (e.target.classList.contains('toggle-checkbox')) {
                    const blockIdx = parseInt(e.target.dataset.blockIdx);
                    const roomId = parseInt(e.target.dataset.roomId);
                    const type = e.target.dataset.type;
                    const isChecked = e.target.checked;

                    const room = state.blocks[blockIdx].rooms.find(r => r.id === roomId);
                    if (room) {
                        if (type === 'ac') room.acOn = isChecked;
                        else if (type === 'light') room.lightOn = isChecked;
                        renderBlocks();
                    }
                }
            });

            blockListContainer.addEventListener('click', (e) => {
                const header = e.target.closest('.block-header');
                if (header) {
                    header.classList.toggle('open');
                    const content = header.nextElementSibling;
                    content.classList.toggle('open');
                }
            });

            saveRoomBtn.addEventListener('click', () => {
                const newRoomName = roomNameInput.value.trim();
                const selectedBlockName = blockSelect.value;
                if (newRoomName && selectedBlockName) {
                    const block = state.blocks.find(b => b.name === selectedBlockName);
                    if (block) {
                        const newId = Math.max(0, ...state.blocks.flatMap(b => b.rooms.map(r => r.id))) + 1;
                        block.rooms.push({
                            id: newId,
                            name: newRoomName,
                            acOn: false,
                            lightOn: false,
                            consumption: 0 // Consumo inicial
                        });
                        roomNameInput.value = '';
                        showScreen('dashboard-screen', 'Monitoramento');
                        renderBlocks();
                    }
                }
            });

            lucide.createIcons();
            renderBlocks();
        });
    </script>
</body>
</html>